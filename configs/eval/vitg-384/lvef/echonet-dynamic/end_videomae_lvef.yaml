# configs/eval/vitg-384/lvef/vjepa_lvef_224px.yaml
# REGRESSION CONFIG  
app: vjepa  
cpus_per_task: 32  
folder: /home/sagemaker-user/user-default-efs/vjepa2/evals/vitg-384/lvef_regression
mem_per_gpu: 80G  
nodes: 1  
tasks_per_node: 8  
num_workers: 8  
  
# Use existing evaluation infrastructure  
eval_name: video_classification_frozen  
resume_checkpoint: true  
tag: lvef-videomae-echonet-dynamic-112px

experiment:  
  classifier:  
    task_type: regression      # NEW: Specify regression task  
    num_heads: 16  
    num_probe_blocks: 4  
    num_targets: 1            # CHANGED: Replace num_classes with num_targets  
  
  data:  
    dataset_type: VideoDataset  
    # UPDATED: Use actual CSV paths with float targets  
    dataset_train: /home/sagemaker-user/user-default-efs/vjepa2/data/csv/echonet_dynamic_train.csv 
    dataset_val:   /home/sagemaker-user/user-default-efs/vjepa2/data/csv/echonet_dynamic_val.csv
      
    resolution: 112  
    frames_per_clip: 16  
    frame_step: 2  
    num_segments: 2  
    num_views_per_segment: 1  

    target_mean: 55.7776
    target_std: 12.4064

  optimization:
    batch_size: 1
    num_epochs: 20
    use_bfloat16: true
    use_pos_embed: false
    # PRUNED REGRESSION GRID
    multihead_kwargs:
      # --- Group 1: 1e-4 ---
      - final_lr: 0.0
        final_weight_decay: 0.01
        lr: 0.0001
        start_lr: 0.0001
        warmup: 0.0
        weight_decay: 0.01
      - final_lr: 0.0
        final_weight_decay: 0.1
        lr: 0.0001
        start_lr: 0.0001
        warmup: 0.0
        weight_decay: 0.1
      - final_lr: 0.0
        final_weight_decay: 0.4
        lr: 0.0001
        start_lr: 0.0001
        warmup: 0.0
        weight_decay: 0.4
      # --- Group 2: 5e-5 ---
      - final_lr: 0.0
        final_weight_decay: 0.01
        lr: 0.00005
        start_lr: 0.00005
        warmup: 0.0
        weight_decay: 0.01
      - final_lr: 0.0
        final_weight_decay: 0.1
        lr: 0.00005
        start_lr: 0.00005
        warmup: 0.0
        weight_decay: 0.1
      - final_lr: 0.0
        final_weight_decay: 0.4
        lr: 0.00005
        start_lr: 0.00005
        warmup: 0.0
        weight_decay: 0.4

model_kwargs:
  checkpoint: /opt/dlami/nvme/checkpoints/videomae_vitl_pretrain.pth
  module_name: evals.video_classification_frozen.modelcustom.videomae_encoder
  pretrain_kwargs:
    encoder:
      model_name: vit_large_patch16_224
      tubelet_size: 2
  wrapper_kwargs: {}
