# configs/eval/vitg-384/echoprime_lvef.yaml

nodes: 1
tasks_per_node: 8
cpus_per_task: 32
mem_per_gpu: 120G

eval_name: video_classification_frozen
folder: /home/sagemaker-user/user-default-efs/vjepa2/evals/echoprime
tag: lvef-a4c-echoprime-224px
resume_checkpoint: false

experiment:
  classifier:
    task_type: regression
    num_targets: 1
    num_probe_blocks: 4
    num_heads: 16

  data:
    dataset_type: VideoDataset
    dataset_train: /home/sagemaker-user/user-default-efs/vjepa2/data/csv/a4c_b_lvef_train_224px.csv
    dataset_val: /home/sagemaker-user/user-default-efs/vjepa2/data/csv/a4c_b_lvef_val_224px.csv
    resolution: 224
    frames_per_clip: 16
    frame_step: 2
    num_segments: 2
    num_views_per_segment: 1

    # IMPORTANT: avoid ImageNet normalization; wrapper applies EchoPrime normalization
    normalization:
      - [0.0, 0.0, 0.0]
      - [1.0, 1.0, 1.0]

  optimization:
    batch_size: 1
    num_epochs: 20
    use_bfloat16: true
    use_pos_embed: false
    # PRUNED REGRESSION GRID
    multihead_kwargs:
      # --- Group 1: 1e-4 ---
      - final_lr: 0.0
        final_weight_decay: 0.01
        lr: 0.0001
        start_lr: 0.0001
        warmup: 0.0
        weight_decay: 0.01
      - final_lr: 0.0
        final_weight_decay: 0.1
        lr: 0.0001
        start_lr: 0.0001
        warmup: 0.0
        weight_decay: 0.1
      - final_lr: 0.0
        final_weight_decay: 0.4
        lr: 0.0001
        start_lr: 0.0001
        warmup: 0.0
        weight_decay: 0.4
      # --- Group 2: 5e-5 ---
      - final_lr: 0.0
        final_weight_decay: 0.01
        lr: 0.00005
        start_lr: 0.00005
        warmup: 0.0
        weight_decay: 0.01
      - final_lr: 0.0
        final_weight_decay: 0.1
        lr: 0.00005
        start_lr: 0.00005
        warmup: 0.0
        weight_decay: 0.1
      - final_lr: 0.0
        final_weight_decay: 0.4
        lr: 0.00005
        start_lr: 0.00005
        warmup: 0.0
        weight_decay: 0.4

model_kwargs:
  checkpoint: null
  module_name: evals.video_classification_frozen.modelcustom.echo_prime_encoder
  pretrain_kwargs: {}
  wrapper_kwargs:
    echo_prime_root: /home/sagemaker-user/user-default-efs/vjepa2/evals/video_classification_frozen/modelcustom/EchoPrime
    # or set explicit absolute paths:
    # encoder_ckpt: /.../model_data/weights/echo_prime_encoder.pt
    # view_ckpt: /.../model_data/weights/view_classifier.pt
    force_fp32: true
    bin_size: 50
